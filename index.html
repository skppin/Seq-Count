<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>15×16 Clickable Grid (1–240)</title>
  <style>
    :root {
      --cols: 16;
      --rows: 15;
      --gap: 6px;
      --cell-size: 46px;
      --green: #2ecc71;
      --border: #d0d0d0;
    }

    body {
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      margin: 20px;
      color: #222;
    }

    header {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 12px 18px;
      margin-bottom: 14px;
    }

    .stats {
      display: flex;
      gap: 14px;
      align-items: center;
      padding: 10px 12px;
      border: 1px solid #eee;
      border-radius: 10px;
      background: #fafafa;
    }

    .stat {
      font-size: 14px;
      line-height: 1.2;
    }

    .stat b {
      font-size: 16px;
    }

    button.action {
      cursor: pointer;
      border: 1px solid #ccc;
      background: white;
      padding: 10px 12px;
      border-radius: 10px;
      font-weight: 700;
    }

    button.action:hover {
      background: #f5f5f5;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(var(--cols), var(--cell-size));
      grid-auto-rows: var(--cell-size);
      gap: var(--gap);
      user-select: none;
    }

    .cell {
      display: flex;
      align-items: center;
      justify-content: center;
      border: 1px solid var(--border);
      border-radius: 10px;
      background: #fff;
      font-weight: 700;
      font-size: 13px;
      transition: transform 80ms ease, background 120ms ease, border-color 120ms ease;
      box-shadow: 0 1px 0 rgba(0,0,0,0.03);
    }

    .cell:active { transform: scale(0.98); }

    .cell.green {
      background: var(--green);
      border-color: #25b864;
      color: #0b3a1e;
    }

    footer {
      margin-top: 12px;
      font-size: 12px;
      color: #666;
    }

    @media (max-width: 900px) { :root { --cell-size: 38px; } }
    @media (max-width: 650px) { :root { --cell-size: 32px; --gap: 5px; } }
  </style>
</head>
<body>
  <header>
    <div class="stats" aria-live="polite">
      <div class="stat">Completed: <b id="completedCount">0</b></div>
      <div class="stat">Remaining: <b id="remainingCount">240</b></div>
      <div class="stat">Total: <b>240</b></div>
    </div>

    <button class="action" id="exportTxtBtn" type="button">Export Completed (.txt)</button>
    <button class="action" id="exportCsvBtn" type="button">Export Completed (.csv / Excel)</button>
  </header>

  <main>
    <div id="grid" class="grid" role="grid" aria-label="15 by 16 clickable grid"></div>
  </main>

  <footer>
    State is saved locally in your browser (localStorage). Close/reopen and it will restore.
  </footer>

  <script>
    (function () {
      const ROWS = 15;
      const COLS = 16;
      const TOTAL = ROWS * COLS;
      const STORAGE_KEY = "grid_15x16_completed_v2";

      const gridEl = document.getElementById("grid");
      const completedCountEl = document.getElementById("completedCount");
      const remainingCountEl = document.getElementById("remainingCount");
      const exportTxtBtn = document.getElementById("exportTxtBtn");
      const exportCsvBtn = document.getElementById("exportCsvBtn");

      function loadState() {
        try {
          const raw = localStorage.getItem(STORAGE_KEY);
          if (!raw) return new Set();
          const arr = JSON.parse(raw);
          if (!Array.isArray(arr)) return new Set();
          return new Set(arr.filter(n => Number.isInteger(n) && n >= 1 && n <= TOTAL));
        } catch {
          return new Set();
        }
      }

      function saveState(completedSet) {
        const arr = Array.from(completedSet).sort((a, b) => a - b);
        localStorage.setItem(STORAGE_KEY, JSON.stringify(arr));
      }

      function updateCounts(completedSet) {
        const completed = completedSet.size;
        const remaining = TOTAL - completed;
        completedCountEl.textContent = String(completed);
        remainingCountEl.textContent = String(remaining);
      }

      function buildGrid(completedSet) {
        gridEl.style.setProperty("--cols", COLS);
        gridEl.innerHTML = "";

        const frag = document.createDocumentFragment();

        for (let i = 1; i <= TOTAL; i++) {
          const cell = document.createElement("button");
          cell.type = "button";
          cell.className = "cell" + (completedSet.has(i) ? " green" : "");
          cell.textContent = i;
          cell.setAttribute("role", "gridcell");
          cell.setAttribute("aria-pressed", completedSet.has(i) ? "true" : "false");
          cell.dataset.index = String(i);

          cell.addEventListener("click", () => {
            const idx = Number(cell.dataset.index);
            if (completedSet.has(idx)) {
              completedSet.delete(idx);
              cell.classList.remove("green");
              cell.setAttribute("aria-pressed", "false");
            } else {
              completedSet.add(idx);
              cell.classList.add("green");
              cell.setAttribute("aria-pressed", "true");
            }
            updateCounts(completedSet);
            saveState(completedSet);
          });

          frag.appendChild(cell);
        }

        gridEl.appendChild(frag);
      }

      function downloadBlob(blob, filename) {
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = filename;
        document.body.appendChild(a);
        a.click();
        a.remove();
        URL.revokeObjectURL(url);
      }

      function getCompletedList(completedSet) {
        return Array.from(completedSet).sort((a, b) => a - b);
      }

      exportTxtBtn.addEventListener("click", () => {
        const list = getCompletedList(completedSet);
        const content = list.length ? list.join("\n") + "\n" : "";
        const blob = new Blob([content], { type: "text/plain;charset=utf-8" });
        downloadBlob(blob, "completed_blocks.txt");
      });

      exportCsvBtn.addEventListener("click", () => {
        // Simple CSV that Excel opens nicely.
        // Column: BlockNumber
        const list = getCompletedList(completedSet);
        const lines = ["BlockNumber", ...list.map(n => String(n))];
        const csv = lines.join("\r\n") + "\r\n";
        const blob = new Blob([csv], { type: "text/csv;charset=utf-8" });
        downloadBlob(blob, "completed_blocks.csv");
      });

      // Init
      const completedSet = loadState();
      buildGrid(completedSet);
      updateCounts(completedSet);
    })();
  </script>
</body>
</html>
